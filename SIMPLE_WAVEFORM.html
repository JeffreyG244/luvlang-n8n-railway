<!DOCTYPE html>
<html>
<head>
    <title>Simple Waveform Test</title>
    <style>
        body {
            background: #000;
            color: #fff;
            font-family: Arial;
            padding: 40px;
        }
        #waveformCanvas {
            border: 3px solid #0f0;
            display: block;
            margin: 20px 0;
            background: #111;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            margin: 10px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>SIMPLE WAVEFORM TEST</h1>
    <input type="file" id="fileInput" accept="audio/*">
    <br>
    <button onclick="drawWaveform()">DRAW WAVEFORM</button>
    <br>
    <canvas id="waveformCanvas" width="800" height="200"></canvas>
    <br>
    <audio id="audio" controls style="width: 800px;"></audio>

    <script>
        let audioBuffer = null;
        let audioContext = null;

        document.getElementById('fileInput').addEventListener('change', async function(e) {
            const file = e.target.files[0];
            if (!file) return;

            console.log('Loading file:', file.name);

            // Create audio context
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }

            // Load into audio element for playback
            const audio = document.getElementById('audio');
            audio.src = URL.createObjectURL(file);

            // Decode for waveform
            const arrayBuffer = await file.arrayBuffer();
            audioBuffer = await audioContext.decodeAudioData(arrayBuffer);

            console.log('✅ Audio loaded:', audioBuffer.duration.toFixed(2), 'seconds');
            console.log('Click "DRAW WAVEFORM" button');

            // Auto-draw
            drawWaveform();
        });

        function drawWaveform() {
            console.log('═══════════════════════════════════');
            console.log('DRAWING WAVEFORM');

            if (!audioBuffer) {
                alert('Load an audio file first!');
                return;
            }

            const canvas = document.getElementById('waveformCanvas');
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;

            console.log('Canvas:', width, 'x', height);

            // Clear
            ctx.fillStyle = '#000000';
            ctx.fillRect(0, 0, width, height);

            // Get channel data
            const data = audioBuffer.getChannelData(0);
            const step = Math.ceil(data.length / width);
            const amp = height / 2;

            console.log('Samples:', data.length, 'Step:', step);

            // Draw waveform
            ctx.strokeStyle = '#00FF00';
            ctx.lineWidth = 2;
            ctx.beginPath();

            for (let i = 0; i < width; i++) {
                let min = 1.0;
                let max = -1.0;

                for (let j = 0; j < step; j++) {
                    const index = i * step + j;
                    if (index < data.length) {
                        const value = data[index];
                        if (value < min) min = value;
                        if (value > max) max = value;
                    }
                }

                const y1 = (1 + min) * amp;
                const y2 = (1 + max) * amp;

                ctx.moveTo(i, y1);
                ctx.lineTo(i, y2);
            }

            ctx.stroke();

            // Center line
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(0, height/2);
            ctx.lineTo(width, height/2);
            ctx.stroke();

            console.log('✅ WAVEFORM DRAWN');
            console.log('═══════════════════════════════════');
        }
    </script>
</body>
</html>
