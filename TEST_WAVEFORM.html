<!DOCTYPE html>
<html>
<head>
    <title>WAVEFORM TEST</title>
    <style>
        body { background: #000; color: #0f0; font-family: monospace; padding: 20px; }
        canvas { border: 2px solid #0f0; display: block; margin: 20px 0; background: #111; }
        button { padding: 10px 20px; font-size: 16px; margin: 10px; background: #0f0; color: #000; border: none; cursor: pointer; }
    </style>
</head>
<body>
    <h1>SIMPLE WAVEFORM TEST</h1>
    <p id="status">Ready. Load an audio file.</p>
    <input type="file" id="fileInput" accept="audio/*">
    <br><br>
    <canvas id="waveform" width="800" height="200"></canvas>
    
    <script>
        let audioBuffer = null;
        let audioContext = null;
        
        document.getElementById('fileInput').addEventListener('change', async function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            document.getElementById('status').textContent = 'Loading ' + file.name + '...';
            console.log('========================================');
            console.log('LOADING:', file.name);
            
            try {
                if (!audioContext) {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    console.log('✅ AudioContext created');
                }
                
                const arrayBuffer = await file.arrayBuffer();
                console.log('✅ File read as ArrayBuffer, size:', arrayBuffer.byteLength);
                
                audioBuffer = await audioContext.decodeAudioData(arrayBuffer);
                console.log('✅ Audio decoded');
                console.log('   Duration:', audioBuffer.duration.toFixed(2), 'seconds');
                console.log('   Sample rate:', audioBuffer.sampleRate);
                console.log('   Channels:', audioBuffer.numberOfChannels);
                
                drawWaveform();
                
            } catch (error) {
                console.error('❌ ERROR:', error);
                document.getElementById('status').textContent = 'ERROR: ' + error.message;
            }
        });
        
        function drawWaveform() {
            if (!audioBuffer) {
                console.warn('⚠️ No audioBuffer!');
                return;
            }
            
            console.log('========================================');
            console.log('DRAWING WAVEFORM');
            
            const canvas = document.getElementById('waveform');
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            console.log('Canvas size:', width, 'x', height);
            
            // Clear black
            ctx.fillStyle = '#000000';
            ctx.fillRect(0, 0, width, height);
            console.log('✅ Cleared canvas');
            
            // Get audio data
            const data = audioBuffer.getChannelData(0);
            const step = Math.ceil(data.length / width);
            const centerY = height / 2;
            const amp = height / 2;
            
            console.log('Samples:', data.length);
            console.log('Step:', step);
            
            // Draw GREEN waveform
            ctx.strokeStyle = '#00FF00';
            ctx.lineWidth = 2;
            ctx.beginPath();
            
            for (let i = 0; i < width; i++) {
                let min = 1.0;
                let max = -1.0;
                
                for (let j = 0; j < step; j++) {
                    const idx = i * step + j;
                    if (idx < data.length) {
                        const val = data[idx];
                        if (val < min) min = val;
                        if (val > max) max = val;
                    }
                }
                
                const y1 = centerY - (max * amp);
                const y2 = centerY - (min * amp);
                
                ctx.moveTo(i, y1);
                ctx.lineTo(i, y2);
            }
            
            ctx.stroke();
            console.log('✅ WAVEFORM DRAWN!');
            
            // Center line
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(0, centerY);
            ctx.lineTo(width, centerY);
            ctx.stroke();
            
            document.getElementById('status').textContent = '✅ WAVEFORM VISIBLE - Green waveform should be showing!';
            console.log('========================================');
        }
    </script>
</body>
</html>
