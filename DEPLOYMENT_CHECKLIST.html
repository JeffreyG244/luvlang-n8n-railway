<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LuvLang Mastering - Deployment Verification</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0a0f;
            color: #fff;
            padding: 40px;
            line-height: 1.6;
        }
        .container { max-width: 800px; margin: 0 auto; }
        h1 {
            background: linear-gradient(135deg, #00d4ff, #b84fff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 30px;
        }
        .check-item {
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            padding: 15px 20px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .status {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }
        .status.pass { background: #00ff88; color: #000; }
        .status.fail { background: #ff4444; color: #fff; }
        .status.warn { background: #ffaa00; color: #000; }
        .status.pending { background: #666; color: #fff; }
        .check-name { flex: 1; }
        .check-detail { font-size: 0.85rem; opacity: 0.7; }
        button {
            background: linear-gradient(135deg, #00d4ff, #b84fff);
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            color: #fff;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
        }
        button:hover { opacity: 0.9; }
        .section { margin-top: 30px; }
        .section-title {
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #00d4ff;
            margin-bottom: 15px;
        }
        #results { margin-top: 30px; }
        .summary {
            background: rgba(0,212,255,0.1);
            border: 1px solid rgba(0,212,255,0.3);
            border-radius: 8px;
            padding: 20px;
            margin-top: 30px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>LuvLang Deployment Verification</h1>
        <p>Run these checks before going live to ensure everything is configured correctly.</p>

        <button onclick="runAllChecks()">Run All Checks</button>

        <div id="results">
            <div class="section">
                <div class="section-title">Configuration</div>
                <div class="check-item" id="check-config">
                    <div class="status pending">?</div>
                    <div>
                        <div class="check-name">LUVLANG_CONFIG loaded</div>
                        <div class="check-detail">Environment-aware configuration</div>
                    </div>
                </div>
                <div class="check-item" id="check-env">
                    <div class="status pending">?</div>
                    <div>
                        <div class="check-name">Production environment detected</div>
                        <div class="check-detail">Should be 'production' on Vercel</div>
                    </div>
                </div>
                <div class="check-item" id="check-demo">
                    <div class="status pending">?</div>
                    <div>
                        <div class="check-name">Demo mode disabled</div>
                        <div class="check-detail">Must be false in production</div>
                    </div>
                </div>
            </div>

            <div class="section">
                <div class="section-title">Stripe Integration</div>
                <div class="check-item" id="check-stripe-loaded">
                    <div class="status pending">?</div>
                    <div>
                        <div class="check-name">Stripe.js loaded</div>
                        <div class="check-detail">Payment processing library</div>
                    </div>
                </div>
                <div class="check-item" id="check-stripe-key">
                    <div class="status pending">?</div>
                    <div>
                        <div class="check-name">Stripe key configured</div>
                        <div class="check-detail">Should be pk_live_* in production</div>
                    </div>
                </div>
            </div>

            <div class="section">
                <div class="section-title">Supabase Integration</div>
                <div class="check-item" id="check-supabase-loaded">
                    <div class="status pending">?</div>
                    <div>
                        <div class="check-name">Supabase library loaded</div>
                        <div class="check-detail">Authentication & database</div>
                    </div>
                </div>
                <div class="check-item" id="check-supabase-client">
                    <div class="status pending">?</div>
                    <div>
                        <div class="check-name">Supabase client initialized</div>
                        <div class="check-detail">Connection to database</div>
                    </div>
                </div>
            </div>

            <div class="section">
                <div class="section-title">Audio Processing</div>
                <div class="check-item" id="check-audio-context">
                    <div class="status pending">?</div>
                    <div>
                        <div class="check-name">Web Audio API available</div>
                        <div class="check-detail">Core audio processing</div>
                    </div>
                </div>
                <div class="check-item" id="check-ai-suite">
                    <div class="status pending">?</div>
                    <div>
                        <div class="check-name">AI Mastering Suite loaded</div>
                        <div class="check-detail">13 AI modules</div>
                    </div>
                </div>
            </div>

            <div class="section">
                <div class="section-title">Security</div>
                <div class="check-item" id="check-https">
                    <div class="status pending">?</div>
                    <div>
                        <div class="check-name">HTTPS enabled</div>
                        <div class="check-detail">Required for payments</div>
                    </div>
                </div>
                <div class="check-item" id="check-tier-verify">
                    <div class="status pending">?</div>
                    <div>
                        <div class="check-name">Server-side tier verification</div>
                        <div class="check-detail">Payment security</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="summary" id="summary" style="display: none;">
            <h3>Summary</h3>
            <p id="summary-text"></p>
        </div>
    </div>

    <!-- Load config first -->
    <script src="config.js"></script>

    <script>
        function setStatus(id, status, detail) {
            const item = document.getElementById(id);
            const statusEl = item.querySelector('.status');
            const detailEl = item.querySelector('.check-detail');

            statusEl.className = 'status ' + status;
            statusEl.textContent = status === 'pass' ? '✓' : status === 'fail' ? '✗' : status === 'warn' ? '!' : '?';

            if (detail) detailEl.textContent = detail;
        }

        async function runAllChecks() {
            let passed = 0;
            let failed = 0;
            let warnings = 0;

            // Check 1: Config loaded
            if (typeof LUVLANG_CONFIG !== 'undefined') {
                setStatus('check-config', 'pass', 'Configuration loaded successfully');
                passed++;
            } else {
                setStatus('check-config', 'fail', 'LUVLANG_CONFIG not found');
                failed++;
            }

            // Check 2: Environment
            if (typeof LUVLANG_CONFIG !== 'undefined') {
                if (LUVLANG_CONFIG.isProduction) {
                    setStatus('check-env', 'pass', 'Production mode active');
                    passed++;
                } else {
                    setStatus('check-env', 'warn', 'Development mode - OK for testing');
                    warnings++;
                }
            } else {
                setStatus('check-env', 'fail', 'Cannot check - config not loaded');
                failed++;
            }

            // Check 3: Demo mode
            if (typeof LUVLANG_CONFIG !== 'undefined') {
                if (!LUVLANG_CONFIG.features.demoMode) {
                    setStatus('check-demo', 'pass', 'Demo mode disabled');
                    passed++;
                } else {
                    setStatus('check-demo', 'warn', 'Demo mode enabled - disable for production');
                    warnings++;
                }
            } else {
                setStatus('check-demo', 'fail', 'Cannot check - config not loaded');
                failed++;
            }

            // Check 4: Stripe.js loaded
            if (typeof Stripe !== 'undefined') {
                setStatus('check-stripe-loaded', 'pass', 'Stripe.js v3 loaded');
                passed++;
            } else {
                setStatus('check-stripe-loaded', 'fail', 'Stripe.js not loaded - add script tag');
                failed++;
            }

            // Check 5: Stripe key
            if (typeof LUVLANG_CONFIG !== 'undefined' && LUVLANG_CONFIG.stripe) {
                const key = LUVLANG_CONFIG.stripe.publishableKey;
                if (key.startsWith('pk_live_')) {
                    setStatus('check-stripe-key', 'pass', 'Live Stripe key configured');
                    passed++;
                } else if (key.startsWith('pk_test_')) {
                    setStatus('check-stripe-key', 'warn', 'Test key - replace with pk_live_* for production');
                    warnings++;
                } else {
                    setStatus('check-stripe-key', 'fail', 'Invalid Stripe key format');
                    failed++;
                }
            } else {
                setStatus('check-stripe-key', 'fail', 'Stripe config not found');
                failed++;
            }

            // Check 6: Supabase library
            if (typeof window.supabase !== 'undefined' && window.supabase.createClient) {
                setStatus('check-supabase-loaded', 'pass', 'Supabase JS loaded');
                passed++;
            } else {
                setStatus('check-supabase-loaded', 'fail', 'Supabase library not loaded');
                failed++;
            }

            // Check 7: Supabase client
            if (typeof window.supabaseClient !== 'undefined' && window.supabaseClient) {
                setStatus('check-supabase-client', 'pass', 'Client initialized');
                passed++;
            } else {
                setStatus('check-supabase-client', 'warn', 'Client not initialized yet - may init on page load');
                warnings++;
            }

            // Check 8: Web Audio API
            if (typeof AudioContext !== 'undefined' || typeof webkitAudioContext !== 'undefined') {
                setStatus('check-audio-context', 'pass', 'Web Audio API available');
                passed++;
            } else {
                setStatus('check-audio-context', 'fail', 'Web Audio API not supported');
                failed++;
            }

            // Check 9: AI Suite
            if (typeof LuvlangAIMasteringSuite !== 'undefined') {
                setStatus('check-ai-suite', 'pass', 'AI Suite loaded');
                passed++;
            } else {
                setStatus('check-ai-suite', 'warn', 'AI Suite not loaded yet - may load on demand');
                warnings++;
            }

            // Check 10: HTTPS
            if (location.protocol === 'https:') {
                setStatus('check-https', 'pass', 'HTTPS enabled');
                passed++;
            } else if (location.hostname === 'localhost' || location.hostname === '127.0.0.1') {
                setStatus('check-https', 'warn', 'HTTP on localhost - OK for development');
                warnings++;
            } else {
                setStatus('check-https', 'fail', 'HTTPS required for payments');
                failed++;
            }

            // Check 11: Server-side tier verification
            if (typeof LUVLANG_CONFIG !== 'undefined' && LUVLANG_CONFIG.features.serverSideTierVerification) {
                setStatus('check-tier-verify', 'pass', 'Server verification enabled');
                passed++;
            } else {
                setStatus('check-tier-verify', 'warn', 'Server verification disabled - enable for security');
                warnings++;
            }

            // Show summary
            const summary = document.getElementById('summary');
            const summaryText = document.getElementById('summary-text');
            summary.style.display = 'block';

            if (failed === 0 && warnings === 0) {
                summaryText.innerHTML = `<span style="color:#00ff88">All ${passed} checks passed!</span> Ready for production.`;
            } else if (failed === 0) {
                summaryText.innerHTML = `<span style="color:#00ff88">${passed} passed</span>, <span style="color:#ffaa00">${warnings} warnings</span>. Review warnings before production.`;
            } else {
                summaryText.innerHTML = `<span style="color:#00ff88">${passed} passed</span>, <span style="color:#ff4444">${failed} failed</span>, <span style="color:#ffaa00">${warnings} warnings</span>. Fix failures before going live.`;
            }
        }
    </script>

    <!-- Stripe.js for testing -->
    <script src="https://js.stripe.com/v3/"></script>

    <!-- Supabase for testing -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</body>
</html>
