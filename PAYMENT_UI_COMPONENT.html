<!-- ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
     LUVLANG LEGENDARY - PAYMENT UI COMPONENT
     ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

     ADD THIS TO YOUR luvlang_LEGENDARY_COMPLETE.html

     Location: Inside the Export section, after the WAV/MP3 format buttons

     ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ -->

<style>
    /* Buy Master Button - Glassmorphism Premium Style */
    .buy-master-btn {
        width: 100%;
        padding: 18px 24px;
        margin-top: 15px;
        background: linear-gradient(135deg, rgba(0, 212, 255, 0.2), rgba(184, 79, 255, 0.2));
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border: 2px solid rgba(0, 212, 255, 0.4);
        border-radius: 12px;
        color: white;
        font-size: 1.1rem;
        font-weight: 700;
        letter-spacing: 0.5px;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow:
            0 8px 32px rgba(0, 212, 255, 0.2),
            inset 0 1px 0 rgba(255, 255, 255, 0.2);
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        position: relative;
        overflow: hidden;
    }

    .buy-master-btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
            90deg,
            transparent,
            rgba(255, 255, 255, 0.2),
            transparent
        );
        transition: left 0.5s;
    }

    .buy-master-btn:hover {
        transform: translateY(-2px);
        border-color: rgba(0, 212, 255, 0.6);
        box-shadow:
            0 12px 48px rgba(0, 212, 255, 0.4),
            inset 0 1px 0 rgba(255, 255, 255, 0.3);
    }

    .buy-master-btn:hover::before {
        left: 100%;
    }

    .buy-master-btn:active {
        transform: translateY(0);
    }

    .buy-master-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
    }

    .buy-master-btn .price {
        font-size: 1.3rem;
        font-weight: 900;
        color: #00d4ff;
        text-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
    }

    .buy-master-btn .description {
        font-size: 0.75rem;
        opacity: 0.8;
        font-weight: 400;
        margin-top: 4px;
        letter-spacing: 0.3px;
    }

    /* Download Button (for already paid files) */
    .download-master-btn {
        width: 100%;
        padding: 18px 24px;
        margin-top: 15px;
        background: linear-gradient(135deg, rgba(76, 175, 80, 0.2), rgba(0, 200, 83, 0.2));
        backdrop-filter: blur(10px);
        border: 2px solid rgba(76, 175, 80, 0.4);
        border-radius: 12px;
        color: white;
        font-size: 1.1rem;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow:
            0 8px 32px rgba(76, 175, 80, 0.2),
            inset 0 1px 0 rgba(255, 255, 255, 0.2);
    }

    .download-master-btn:hover {
        transform: translateY(-2px);
        box-shadow:
            0 12px 48px rgba(76, 175, 80, 0.4),
            inset 0 1px 0 rgba(255, 255, 255, 0.3);
    }

    /* Payment Status Badge */
    .payment-status {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 8px 16px;
        margin-top: 10px;
        background: rgba(76, 175, 80, 0.15);
        border: 1px solid rgba(76, 175, 80, 0.3);
        border-radius: 20px;
        font-size: 0.85rem;
        color: #4CAF50;
    }

    .payment-status.locked {
        background: rgba(255, 193, 7, 0.15);
        border-color: rgba(255, 193, 7, 0.3);
        color: #FFC107;
    }

    .payment-status-icon {
        font-size: 1.2rem;
    }
</style>

<!-- ADD THIS INSIDE YOUR EXPORT SECTION -->
<div class="export-section">
    <div class="section-title">Export</div>

    <!-- ... existing format buttons ... -->

    <!-- PAYMENT/DOWNLOAD SECTION -->
    <div id="paymentSection" style="margin-top: 20px;">
        <!-- Payment Status Badge -->
        <div id="paymentStatusBadge" class="payment-status locked" style="display: none;">
            <span class="payment-status-icon">üîí</span>
            <span id="paymentStatusText">Not yet purchased</span>
        </div>

        <!-- Buy Master Button -->
        <button class="buy-master-btn" id="buyMasterBtn" onclick="downloadMaster()" disabled>
            <div>
                <div>üíé Buy Professional Master</div>
                <div class="price">$29.99</div>
                <div class="description">Broadcast-quality WAV ‚Ä¢ Instant download</div>
            </div>
        </button>

        <!-- Download Button (shown when already paid) -->
        <button class="download-master-btn" id="downloadMasterBtn" onclick="downloadMaster()" style="display: none;">
            <div>
                <div>‚¨áÔ∏è Download Your Master</div>
                <div style="font-size: 0.75rem; opacity: 0.8; margin-top: 4px;">
                    Secure 60-second link
                </div>
            </div>
        </button>
    </div>

    <!-- Existing Export Button (for free preview/demo) -->
    <button class="export-btn" id="exportBtn" style="margin-top: 15px;">
        Export Preview (Demo Quality)
    </button>
</div>

<script>
    // ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
    // UPDATE PAYMENT UI BASED ON AUDIO STATE
    // ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

    async function updatePaymentUI() {
        const buyBtn = document.getElementById('buyMasterBtn');
        const downloadBtn = document.getElementById('downloadMasterBtn');
        const statusBadge = document.getElementById('paymentStatusBadge');
        const statusText = document.getElementById('paymentStatusText');

        // Check if audio is loaded
        if (!audioBuffer) {
            buyBtn.disabled = true;
            buyBtn.textContent = 'Please upload and master audio first';
            downloadBtn.style.display = 'none';
            statusBadge.style.display = 'none';
            return;
        }

        // Enable buy button
        buyBtn.disabled = false;

        // Check if user is authenticated
        const { data: { user } } = await window.supabase.auth.getUser();

        if (!user) {
            statusBadge.style.display = 'flex';
            statusBadge.classList.add('locked');
            statusText.textContent = 'Sign in to purchase';
            return;
        }

        // Check if file is already paid
        const filePath = window.currentMasterFilePath;
        if (!filePath) {
            statusBadge.style.display = 'flex';
            statusBadge.classList.add('locked');
            statusText.textContent = 'Ready to purchase';
            return;
        }

        const { data: orders } = await window.supabase
            .from('orders')
            .select('status')
            .eq('user_id', user.id)
            .eq('file_path', filePath)
            .eq('status', 'completed')
            .limit(1);

        if (orders && orders.length > 0) {
            // Already paid - show download button
            buyBtn.style.display = 'none';
            downloadBtn.style.display = 'block';
            statusBadge.style.display = 'flex';
            statusBadge.classList.remove('locked');
            statusText.innerHTML = '<span class="payment-status-icon">‚úÖ</span> Purchased';
        } else {
            // Not paid - show buy button
            buyBtn.style.display = 'block';
            downloadBtn.style.display = 'none';
            statusBadge.style.display = 'flex';
            statusBadge.classList.add('locked');
            statusText.textContent = 'Ready to purchase';
        }
    }

    // Update UI when audio is loaded
    if (typeof audioBuffer !== 'undefined') {
        updatePaymentUI();
    }

    // Update UI on auth state change
    if (window.supabase) {
        window.supabase.auth.onAuthStateChange(() => {
            updatePaymentUI();
        });
    }
</script>
