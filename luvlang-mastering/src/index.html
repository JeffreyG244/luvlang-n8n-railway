<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <title>LuvLang Mastering Studio</title>

    <!-- SEO & Social -->
    <meta name="description" content="Professional AI-powered audio mastering platform. EBU R128 LUFS metering, 7-band EQ, dynamics processing, batch mastering, and podcast optimization.">
    <meta name="theme-color" content="#00d4ff">
    <meta name="application-name" content="LuvLang Mastering">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="LuvLang">
    <meta property="og:title" content="LuvLang Mastering Studio">
    <meta property="og:description" content="Professional AI-powered audio mastering in your browser">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://luvlang.studio">
    <meta name="twitter:card" content="summary_large_image">

    <!-- Preconnect to critical services -->
    <link rel="preconnect" href="https://api.luvlang.studio" crossorigin>
    <link rel="dns-prefetch" href="https://api.stripe.com">
    <link rel="dns-prefetch" href="https://js.stripe.com">

    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">

    <!-- Stylesheets (external, cacheable) -->
    <link rel="stylesheet" href="/src/css/components.css">
    <link rel="stylesheet" href="/src/css/mobile.css">

    <!-- Critical inline styles for instant first paint -->
    <style>
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

        :root {
            --color-bg: #0a0a0f;
            --color-bg-card: #1a1a24;
            --color-cyan: #00d4ff;
            --color-purple: #b84fff;
            --color-text: #e0e0e0;
            --color-text-muted: #a0a0a0;
            --color-border: rgba(255,255,255,0.1);
            --color-success: #22c55e;
            --color-error: #ff3c3c;
            --color-warning: #ff8800;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, var(--color-bg) 0%, var(--color-bg-card) 100%);
            color: var(--color-text);
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Loading state */
        #app-loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            gap: 20px;
        }
        #app-loading .spinner {
            width: 48px; height: 48px;
            border: 3px solid var(--color-border);
            border-top-color: var(--color-cyan);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        #app-loading .brand {
            font-size: 1.5rem; font-weight: 700;
            background: linear-gradient(135deg, var(--color-cyan), var(--color-purple));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        #app-loading .status {
            font-size: 0.85rem; color: var(--color-text-muted);
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* App root hidden until ready */
        #app-root { display: none; }
        #app-root.ready { display: block; }
    </style>
</head>
<body>
    <!-- Loading state (visible immediately) -->
    <div id="app-loading" role="status" aria-busy="true" aria-label="Loading LuvLang Mastering Studio">
        <div class="spinner" aria-hidden="true"></div>
        <div class="brand">LuvLang Mastering</div>
        <div class="status" id="load-status">Loading modules...</div>
    </div>

    <!-- Main application (hidden until ready) -->
    <div id="app-root" aria-busy="false">
        <!-- Left Sidebar -->
        <aside id="left-sidebar" class="sidebar left-sidebar">
            <nav id="main-nav"></nav>
            <div id="preset-panel"></div>
        </aside>

        <!-- Center Main Area -->
        <main id="center-main" class="center-main">
            <!-- Audio Drop Zone -->
            <div id="audio-dropzone" class="audio-dropzone">
                <p>Drop audio file here or click to browse</p>
                <input type="file" id="audio-file-input" accept="audio/*" hidden>
            </div>

            <!-- Transport Controls -->
            <div id="transport-controls"></div>

            <!-- EQ Panel -->
            <section id="eq-panel" class="panel"></section>

            <!-- Dynamics Panel -->
            <section id="dynamics-panel" class="panel"></section>

            <!-- Master Panel -->
            <section id="master-panel" class="panel"></section>

            <!-- Multitrack Panel -->
            <section id="multitrack-panel" class="panel"></section>

            <!-- Podcast Panel -->
            <section id="podcast-panel" class="panel"></section>

            <!-- Batch Panel -->
            <section id="batch-panel" class="panel"></section>
        </main>

        <!-- Right Sidebar -->
        <aside id="right-sidebar" class="sidebar right-sidebar">
            <!-- Analytics Dashboard -->
            <div id="analytics-panel"></div>

            <!-- AI Suggestions -->
            <div id="ai-suggestions-panel"></div>

            <!-- Undo Timeline -->
            <div id="undo-timeline"></div>

            <!-- Collaboration -->
            <div id="collaboration-panel"></div>
        </aside>

        <!-- Pricing Page (hidden by default) -->
        <div id="pricing-page" class="page" hidden></div>
    </div>

    <!-- Mobile Bottom Nav -->
    <nav id="mobile-bottom-nav" class="mobile-bottom-nav" hidden>
        <button data-panel="eq" class="nav-btn active">EQ</button>
        <button data-panel="dynamics" class="nav-btn">Dyn</button>
        <button data-panel="master" class="nav-btn">Master</button>
        <button data-panel="analytics" class="nav-btn">Analyze</button>
        <button data-panel="more" class="nav-btn">More</button>
    </nav>

    <!-- App Module (deferred, non-blocking) -->
    <script type="module">
        const status = document.getElementById('load-status');

        try {
            status.textContent = 'Loading audio engine...';

            const { LuvLangApp } = await import('./js/index.js');

            status.textContent = 'Initializing...';

            const app = new LuvLangApp();
            window.luvlang = app;

            await app.init();

            // Hide loading, show app
            document.getElementById('app-loading').hidden = true;
            document.getElementById('app-root').classList.add('ready');

            // Show mobile nav on small screens
            if (window.innerWidth < 768) {
                document.getElementById('mobile-bottom-nav').hidden = false;
            }

        } catch (error) {
            console.error('Failed to load LuvLang:', error);
            status.textContent = 'Failed to load. Please refresh.';
            status.style.color = '#ff3c3c';
        }
    </script>

    <!-- Service Worker Registration (after page load) -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js', { scope: '/' })
                    .then(reg => {
                        if (reg.waiting) {
                            // New SW waiting - could prompt user to refresh
                        }
                    })
                    .catch(() => {
                        // SW registration failed - app still works without it
                    });
            });
        }
    </script>
</body>
</html>
